<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Игра</title>
    <style type="text/css">
        .btn {
            padding: 5px;
            height: 30px;
            width: 30px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .btn_section {
            background-color: #fc0;
            margin-right: 10px;
            margin-top: 10px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .btn_left {
            background-color: #fc0;
            padding: 0px;
            margin-right: 10px;
            margin-top: 10px;
        }

        .text {
             writing-mode: vertical-lr;
             text-orientation: upright;
        }

        section {
            position: absolute;
            top: 50%;
            left: 50%;
            margin-right: -50%;
            transform: translate(-50%, -50%)
        }

        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .flash {padding: 10px;}

        .flash.success {
             border: 1px solid #21DB56;
             background: #AEFFC5;
        }

        .flash.error {
             border: 1px solid #FF4343;
             background: #FF9C9C;
        }

    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js" integrity="sha512-zN6KYOtONNTOGXz0RkWX2EpavN9VdIs+2w+To+fhciFv83YA9maUpi2lzZWrOfKXdFIZZomWufBznkyHi3a8oQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>

        const socket = io();

        // получить данные от сокета и перебрать

        // TODO: написать чтоб загрузка, инициализация данных проходила вне зависимости от сокета

        socket.on("game", function(data){

            var arrays = data["arrays"];
            var row, column;

            var container = document.getElementsByClassName("container")[0];

            for (row = 0; row < arrays.length; ++row) {

                let parents = document.createElement('div');
                container.append(parents)

                for (column = 0; column < arrays[row].length; ++column) {

                    let cell = JSON.parse(arrays[row][column]);

                    let children = document.createElement('div');
                    parents.append(children)

                    let button = document.createElement('button');
                    children.append(button)

                    button.setAttribute("name", cell.row);
                    button.setAttribute("value", cell.column);
                    button.setAttribute("type", "button");
                    button.className = "btn";

                    button.innerHTML = cell.count_mine_near

                }

            }

            // получить данные из атрибутов нажатой кнопки на поле
            var button = document.querySelectorAll('.container [type="button"]');

            for (var i = 0; i < button.length; i++) {
                button[i].addEventListener('click', requestSocket, false);
            }

            // функция отправки данных на сервер
            function requestSocket(element) {
                socket.emit("result", {

                    response: [this.value, this.name]

                });

                console.log([this.value, this.name]);
            }

        });

    </script>
</head>
<body>
    <form method="POST" id="cl"></form>

    {% for cat, msg in get_flashed_messages(True) %}
        {% if msg %}
        <section>
            <div class="flash {{cat}}">{{msg}}</div>
            <br>
            <center><button class="btn_section" type="submit" form="cl" formaction="{{ url_for('index') }}">НОВАЯ ИГРА</button></center>
        </section>
        {% endif %}
    {% endfor %}

        <div class="container">
            <div>
                <center>
                    <button id="btn" class="btn_left" value="restart" type="submit" name="method">
                        <span class="text">Отправить</span>
                    </button>
                </center>

                <center>
                    <button class="btn_left" value="restart" type="submit" name="method">
                        <span class="text">обновить</span>
                    </button>
                </center>

                <center>
                    <button class="btn_left" type="submit">
                        <span class="text">выбор сложности</span>
                    </button>
                </center>
            </div>
        </div>
</body>
</html>